MPASM 5.55  /HOME/GILSON/UFRGS/MICROS/PROJET   4-6-2014  5:50:36         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 #include <p16f684.inc>
                      00001         LIST
                      00002 
                      00003 ;==========================================================================
                      00004 ;  MPASM PIC16F684 processor include
                      00005 ; 
                      00006 ;  (c) Copyright 1999-2014 Microchip Technology, All rights reserved
                      00007 ;==========================================================================
                      00008 
                      00523         LIST
                      00002 
2007   3FF4           00003  __CONFIG _FOSC_INTOSCIO & _WDTE_OFF & _PWRTE_OFF & _MCLRE_ON & _CP_OFF & _CPD_OFF & _BOREN_ON & _IESO_O
                            N & _FCMEN_ON
                      00004 
                      00005     errorlevel  -302                ; suppress message 302 from list file
                      00006 
  00000000            00007 ADDR_EE_POS     EQU 0x00
  00000002            00008 IrDAb           EQU RA2
  00000005            00009 IrDAp           EQU PORTA
  00000005            00010 ENA_DISP        EQU RA5
  00000005            00011 DISPLAYp        EQU PORTA
  00000001            00012 DEVICE          EQU 0X01    ; MODO TV DO CONTROLE SONY RMT-V297C
  00000000            00013 MODEAUTO        EQU 0
                      00014 
                      00015                 UDATA   0X50
0050                  00016 IrDA_bits       res 1
0051                  00017 IrDA_discard    res 1
0052                  00018 IrDA_DATA       res 3
0055                  00019 IrDA_command    res 1
0056                  00020 SMCON           res 1
0057                  00021 count_disp      res 1
                      00022 
0058                  00023 pos_value       res 1   ; 0 desligado, outros define o nível de luminosidade
0059                  00024 motor_pos       res 1
005A                  00025 counter         res 1
                      00026 
005B                  00027 B1              res 1
005C                  00028 B2              res 1
005D                  00029 LOOP_BCD_COUNTER    res 1
005E                  00030 VALUE_BIN       res 1
                      00031 
                      00032 
                      00033                 UDATA_SHR
0000                  00034 w_temp          res 1
0001                  00035 w_bk            res 1   ; armazena backup do acumulador
0002                  00036 status_bk       res 1
                      00037 
                      00038 
0003                  00039 record_data     res 1
0004                  00040 record_addr     res 1
                      00041 
                      00042 RESET_VECTOR    CODE    0x0000  ; processor reset vector
0000   2???           00043         goto    start           ; go to beginning of program
MPASM 5.55  /HOME/GILSON/UFRGS/MICROS/PROJET   4-6-2014  5:50:36         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00044 
                      00045 
                      00046 ;============================================================================
                      00047 ; Seção de tratamento de interrupções
                      00048 ;
                      00049 ;   ESTA ESTRUTURA FOI UTILIZADA PARA NÃO PERMITIR CHAMADAS CONTINUAS DENTRO
                      00050 ;   DESTA FUNÇÃO CASO SEJA CHAMADO MAIS DE UMA INTERRUPÇÃO, SERVE PARA MANTER
                      00051 ;   A HIERARQUIA DE PROCESSAMENTO
                      00052 ;
                      00053 ;============================================================================
                      00054 INT_VECTOR      CODE    0x0004  ; interrupt vector location
                      00055 
0004                  00056 INTERRUPT
0004   1018           00057         BCF     WDTCON, SWDTEN  ; DESTIVA O WATCH-DOG
0005   138B           00058         BCF     INTCON, GIE     ; DESABILITA INTERRUPÇÃO GLOBAL
                      00059 
0006   00??           00060         movwf   w_bk            ; save off current W register contents
0007   0803           00061         movf    STATUS, W       ; move status register into W register
0008   00??           00062         movwf   status_bk       ; save off contents of STATUS register
                      00063 
0009   188B           00064         BTFSC   INTCON, INTF    ; TESTA SE A INTERRUPÇÃO OCORREU PELA ENTRADA DO IrDA
000A   2???           00065         GOTO    IrDA_FALLING
000B   188C           00066         BTFSC   PIR1, TMR2IF    ; TESTA SE A INTERRUPÇÃO ACONTECEU PELO CONTADOR
000C   2???           00067         GOTO    IrDA_TIME
                      00068 
000D                  00069 END_INTERRUPT
000D   08??           00070         movf    status_bk, W    ; retrieve copy of STATUS register
000E   0083           00071         movwf   STATUS          ; restore pre-isr STATUS register contents
000F   0E??           00072         swapf   w_bk, F
0010   0E??           00073         swapf   w_bk, W         ; restore pre-isr W register contents
                      00074 
0011   178B           00075         BSF     INTCON, GIE     ; HABILITA INTERRUPÇÃO GLOBAL
0012   0009           00076         retfie                  ; return from interrupt
                      00077 
0013                  00078 IrDA_FALLING
0013   108B           00079         BCF     INTCON, INTF    ; TESTA SE A INTERRUPÇÃO OCORREU PELA ENTRADA DO IrDA
0014   2???           00080         CALL    IrDA_FALL       ; CHAMA ROTINA DE TRATAMENTO DA RECEPÇÃO DO CONTROLE REMOTO
0015   2???           00081         GOTO    END_INTERRUPT
0016                  00082 IrDA_TIME
0016   108C           00083         BCF     PIR1, TMR2IF    ; TESTA SE A INTERRUPÇÃO ACONTECEU PELO CONTADOR
0017   2???           00084         CALL    IrDA_SAMPLER
0018   2???           00085         GOTO    END_INTERRUPT
                      00086 
                      00087 
                      00088 
                      00089 
                      00090 ;============================================================================
                      00091 ; boostrap da máquina
                      00092 ;
                      00093 ;
                      00094 ;
                      00095 ;============================================================================
                      00096 
MPASM 5.55  /HOME/GILSON/UFRGS/MICROS/PROJET   4-6-2014  5:50:36         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00097 MAIN    CODE
                      00098 
0000                  00099 start   ; PRÉ-SET DO AMBIENTE DE EXECUÇÃO
0000   018B           00100         CLRF    INTCON
                      00101 
0001   1683           00102         BSF     STATUS, RP0     ; APONTA PARA BLOCO 1
0002   3001           00103         MOVLW   b'00000001'
0003   0081           00104         MOVWF   OPTION_REG      ; DEFINE PRESCALER DO TIMER 0, COLOCA INT/RA2 EM FALLING EDGE
0004   301F           00105         MOVLW   0X1F            ; b'00011111'
0005   0085           00106         MOVWF   TRISA           ; DEFINE I/O DA PORTA A
0006   0187           00107         CLRF    TRISC           ; DEFINE PORTA C COMO SAÍDAS
0007   3008           00108         MOVLW   b'00001000'
0008   0091           00109         MOVWF   ANSEL           ; DEFINE AS PORTAS QUE SÃO ANALÓGICAS
0009   0196           00110         CLRF    IOCA
000A   3004           00111         MOVLW   b'00000100'
000B   0095           00112         MOVWF   WPUA            ; DESATIVA PULL-UP
000C   3010           00113         MOVLW   0X10
000D   009F           00114         MOVWF   ADCON1          ; DEFINE OSCILADOR 1/8 ~ 2us PARA O CONVERSOR A/D
000E   3002           00115         MOVLW   b'00000010'
000F   008C           00116         MOVWF   PIE1            ; HABILITA INTERRUPÇÃO POR TIMER2
0010   30E1           00117         MOVLW   0XE1
0011   0092           00118         MOVWF   PR2             ; COLOCA 160 NO COMPARADOR DO TIMER 2 (IrDA) 2560 us EM 4MHz
                      00119 
                      00120 
0012   1283           00121         BCF     STATUS, RP0     ; APONTA PARA O BANCO 0
0013   0185           00122         CLRF    PORTA           ; INIT PORTA
0014   0187           00123         CLRF    PORTC
0015   3007           00124         MOVLW   0X07
0016   0099           00125         MOVWF   CMCON0          ; DESLIGA OS COMPARADORES
0017   300C           00126         MOVLW   0X0C
0018   009F           00127         MOVWF   ADCON0          ; HABILITA ENTRADA ANALÓGICA 3 E AJUSTA PARA SAIDA JUSTIFICADA A ESQUERD
                            A
0019   3016           00128         MOVLW   0X16
001A   0098           00129         MOVWF   WDTCON          ; AJUSTA PRESCALER DO WATCH-DOG PARA 1:65536 ~ 2 segundos
001B   018C           00130         CLRF    PIR1            ; ZERA FLAGS DE INTERRUPÇÕES DOS PERIFÉRICOS
                      00131 
001C   3050           00132         MOVLW   b'01010000'
001D   008B           00133         MOVWF   INTCON          ; HABILITA INT/RA2, PERIFÉRICOS
                      00134 
                      00135         ; Inicalização da RAM
                      00136         ;BTFSC   EECON1, WRERR   ; TESTA SE HOUVE ERRO DE GRAVAÇÃO DURANTE RESET
                      00137         ;CALL    RECORD_POSITION
                      00138         ;CALL    READ_POSITION
                      00139 
                      00140         ; Teste da interação
001E   3070           00141         MOVLW   0X70
001F   00??           00142         MOVWF   pos_value
                      00143         ;CALL    RECORD_POSITION
                      00144 
                      00145 ;        CLRF    record_addr
0020   178B           00146         BSF     INTCON, GIE
                      00147 
0021   01??           00148         CLRF    SMCON           ; inicializa estrutura da maquina de estados
MPASM 5.55  /HOME/GILSON/UFRGS/MICROS/PROJET   4-6-2014  5:50:36         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0022   01??           00149         CLRF    IrDA_command    ; inicializa comando do controle remoto
0023   2???           00150         CALL    INIT_IrDA       ; inicializa estruturas de recepção do controle remoto
                      00151 
                      00152         ;BSF SMCON, MODEAUTO
                      00153 
0024                  00154 MAIN_1
0024   1C00           00155         BTFSS   SMCON, MODEAUTO    ; se automático liga watch-dog
0025   1E85           00156         BTFSS   DISPLAYp, ENA_DISP
0026   1418           00157         BSF     WDTCON, SWDTEN
                      00158 
0027   1D12           00159         BTFSS   T2CON, TMR2ON
0028   0063           00160         SLEEP
0029   1018           00161         BCF     WDTCON, SWDTEN
                      00162 
                      00163 
002A   1A03           00164         BTFSC   STATUS, NOT_TO  ; testa se saiu do sleep por watch-dog
002B   2???           00165         GOTO    MAIN_1
002C   1685           00166         BSF     DISPLAYp, ENA_DISP  ; desliga display
002D   1800           00167         BTFSC   SMCON, 0
002E   2???           00168         CALL    AUTO_REFRESH
002F   2???           00169         GOTO    MAIN_1
                      00170 
0030   2???           00171         GOTO    start           ; ocorreu algum erro, resetar
                      00172 
                      00173 
                      00174 ;============================================================================
                      00175 ;
                      00176 ; Seção com funções
                      00177 ;
                      00178 ;
                      00179 ;============================================================================
                      00180 
                      00181 FUNCTIONS CODE
                      00182 
                      00183 ;============================================================================
                      00184 ;
                      00185 ;   Delay de 1000 ciclos de clock de instrução
                      00186 ;
                      00187 ;     Presupõe que a interrupção de overflow do timer0 está desativada, caso
                      00188 ;   contrário o comportamento é imprevisível.
                      00189 ;
                      00190 ;     O timer utiliza um ajuste para se obter o consumo de 1000 ciclos desde
                      00191 ;   a instrução de chamada até o retorno na instrução seguinte
                      00192 ;
                      00193 ;==============================================================================
                      00194 
0000                  00195 DELAYms: ; com preescaler em 1:4 desde o call até o retorno gasta 1000 ciclos
                      00196 
                      00197         ; AJUSTA PARÂMETROS DO CONTADOR
                      00198         ;
                      00199         ; PRESCALER 1:4
                      00200         ; INCREMENTA NA DESCIDA DO CLOCK
                      00201         ; USA O CLOCK DE INSTRUÇÃO COMO BATE DE TEMPO
MPASM 5.55  /HOME/GILSON/UFRGS/MICROS/PROJET   4-6-2014  5:50:36         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00202         ;
0000   30C0           00203         MOVLW   b'11000000'
0001   0501           00204         ANDWF   OPTION_REG, W
0002   3801           00205         IORLW   b'00000001'
0003   0081           00206         MOVWF   OPTION_REG
                      00207 
                      00208 ;laço do timer
0004   300A           00209         MOVLW   0X0A                ; AJUSTA CONTADOR PARA GERAR A SAÍDA CORRETA
0005   0081           00210         MOVWF   TMR0                ; ATUALIZA CONTADOR
0006   110B           00211         BCF     INTCON, T0IF
0007   1D0B           00212         BTFSS   INTCON, T0IF
0008   2???           00213         GOTO $-1
0009   0008           00214     RETURN
                      00215 
                      00216 
                      00217 ;============================================================================
                      00218 ;
                      00219 ;   INICIALIZA ESTRUTURAS PARA RECEPÇÃO DE UM COMANDO DO CONTROLE REMOTO
                      00220 ;
                      00221 ;============================================================================
000A                  00222 INIT_IrDA:
000A   01??           00223         CLRF    IrDA_bits
000B   3011           00224         MOVLW   b'00010001'     ; PRESCALER 1:4 POSTSCALER 1:3
000C   0092           00225         MOVWF   T2CON
000D   0191           00226         CLRF    TMR2            ; ZERA CONTADOR
000E   0008           00227         RETURN
                      00228 
                      00229 ;============================================================================
                      00230 ;
                      00231 ; TRATAMENTO DA RECEPÇÃO DOS DADOS DO CONTROLE REMOTO
                      00232 ; PRESUPOE QUE TIMER 2 NÃO É USADO POR MAIS NINGUEM
                      00233 ;
                      00234 ;============================================================================
000F                  00235 IrDA_FALL:
000F   1A92           00236         BTFSC   T2CON, 5        ; TESTA SE É 1:5
0010   2???           00237         GOTO    IrDA_FALL_SAMPLE_1
                      00238 
0011   1912           00239         BTFSC   T2CON, TMR2ON
0012   2???           00240         GOTO    IrDA_FALL_ABORT
                      00241 
0013   1A12           00242         BTFSC   T2CON, 4        ; TESTA SE ESTA NO 1:3
0014   2???           00243         GOTO    IrDA_FALL_SAMPLE
                      00244 
0015                  00245 IrDA_FALL_ABORT
0015   2???           00246         CALL INIT_IrDA
0016   0008           00247         RETURN
                      00248 
0017                  00249 IrDA_FALL_SAMPLE_1
0017   1292           00250         BCF     T2CON, 5
0018                  00251 IrDA_FALL_SAMPLE
0018   01??           00252         CLRF    IrDA_command
0019   0191           00253         CLRF    TMR2
001A   1512           00254         BSF     T2CON, TMR2ON
MPASM 5.55  /HOME/GILSON/UFRGS/MICROS/PROJET   4-6-2014  5:50:36         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

001B   0008           00255         RETURN
                      00256 
                      00257 ;===========================================================================
                      00258 ;
                      00259 ;   ROTINA QUE TRATA DA LEITURA DO BIT DO IrDA NA PORTA
                      00260 ;   BYTE 0 - DEVICE
                      00261 ;   BYTE 1 - COMANDO
                      00262 ;   BYTE 2 - EXTENÇÃO (SÓ EM 20 BITS)
                      00263 ;
                      00264 ;   INTERRUPÇÃO DEVE CESSAR DEPOIS DE ALTERAR ESTADO DA MÁQUINA DE ESTADOS
                      00265 ;===========================================================================
                      00266 
001C                  00267 IrDA_SAMPLER:
                      00268 
001C   1A92           00269         BTFSC   T2CON, 5        ; TESTA SE É 1:5
001D   2???           00270         GOTO    IrDA_SAMPLER_5  ; 1:5
001E   1E12           00271         BTFSS   T2CON, 4        ;TESTA DE É 1:3
001F   2???           00272         GOTO    IrDA_SAMPLER_1
0020   1D05           00273         BTFSS   IrDAp, IrDAb    ; TESTA NÍVEL LÓGICO DA PORTA, DEVE SER ALTO
0021   2???           00274         GOTO    IrDA_SAMPLER_ABORT
0022   1212           00275         BCF     T2CON, 4
0023   2???           00276         GOTO    IrDA_SAMPLER_3
                      00277 
0024                  00278 IrDA_SAMPLER_1
0024   0A??           00279         INCF    IrDA_bits, F
                      00280 
0025   1003           00281         BCF     STATUS, C       ; INVERTE BIT VINDO DA LÓGICA
0026   1D05           00282         BTFSS   IrDAp, IrDAb
0027   1403           00283         BSF     STATUS, C
                      00284 
                      00285         ; COLOCA BIT NO ARRAY
0028   0C??           00286         RRF     IrDA_DATA, F
0029   0C??           00287         RRF     IrDA_DATA+1, F
002A   0C??           00288         RRF     IrDA_DATA+2, F
                      00289 
002B                  00290 IrDA_SAMPLER_3
002B   1692           00291         BSF     T2CON, 5        ; ATIVA POSTSCALER 1:5
002C   0191           00292         CLRF    TMR2
002D   0008           00293         RETURN
                      00294 
                      00295 
                      00296 ; PRESCALER DE 1:5
                      00297 ; ATINGIU O LIMITE DE TEMPO DE ESPERA
                      00298 ; VERIFICA SE A QUANTIDADE DE BITS SE ENQUADRA EM ALGUM PADRÃO
002E                  00299 IrDA_SAMPLER_5
002E   300C           00300         MOVLW   0X0C            ; 12 BITS
002F   06??           00301         XORWF   IrDA_bits, W
0030   1903           00302         BTFSC   STATUS, Z
0031   2???           00303         GOTO    IrDA_COMMAND_12_BITS
                      00304 
0032   300F           00305         MOVLW   0X0F            ; 15 BITS
0033   06??           00306         XORWF   IrDA_bits, W
0034   1903           00307         BTFSC   STATUS, Z
MPASM 5.55  /HOME/GILSON/UFRGS/MICROS/PROJET   4-6-2014  5:50:36         PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0035   2???           00308         GOTO    IrDA_COMMAND_15_BITS
                      00309 
0036   3014           00310         MOVLW   0X14            ; 20 BITS
0037   06??           00311         XORWF   IrDA_bits, W
0038   1D03           00312         BTFSS   STATUS, Z
0039   2???           00313         CALL    IrDA_SAMPLER_ABORT
                      00314 
                      00315 ; INTERVALO DE CÓDIGO QUE CORRIGE POSIÇÃO DOS BITS
                      00316 
003A   08??           00317         MOVF    IrDA_DATA, W
003B   00??           00318         MOVWF   w_temp
003C   08??           00319         MOVF    IrDA_DATA+1, W
003D   00??           00320         MOVWF   IrDA_DATA
003E   08??           00321         MOVF    IrDA_DATA+2, W
003F   00??           00322         MOVWF   IrDA_DATA+1
0040   08??           00323         MOVF    w_temp, W
0041   00??           00324         MOVWF   IrDA_DATA+2
                      00325 
0042                  00326 IrDA_COMMAND_12_BITS
0042   30F0           00327         MOVLW   b'11110000'
0043   05??           00328         ANDWF   IrDA_DATA+1, F
0044   1003           00329         BCF     STATUS, C
0045   0C??           00330         RRF     IrDA_DATA, F
0046   0C??           00331         RRF     IrDA_DATA+1, F
0047   0C??           00332         RRF     IrDA_DATA, F
0048   0C??           00333         RRF     IrDA_DATA+1, F
0049   0C??           00334         RRF     IrDA_DATA, F
004A   0C??           00335         RRF     IrDA_DATA+1, F
                      00336 
004B                  00337 IrDA_COMMAND_15_BITS
                      00338 
004B   1003           00339         BCF     STATUS, C
004C   0C??           00340         RRF     IrDA_DATA+1, F
                      00341 
                      00342 ; FIM DAS CORREÇÕES DE POSIÇÃO
                      00343 
                      00344 
004D   08??           00345         MOVF    IrDA_DATA, W
004E   3A01           00346         XORLW   DEVICE
004F   1D03           00347         BTFSS   STATUS, Z           ; testa dispositivo
0050   2???           00348         GOTO    IrDA_SAMPLER_ABORT
                      00349 
                      00350         ; TODO: tratar melhor o descarte do envio triplo
0051   03??           00351         DECF    IrDA_discard, F
0052   3003           00352         MOVLW   0x03
0053   05??           00353         ANDWF   IrDA_discard, F
0054   1D03           00354         BTFSS   STATUS, Z
0055   2???           00355         GOTO    IrDA_SAMPLER_ABORT  ; descarta envio triplo do controle
                      00356 
0056   03??           00357         DECF    IrDA_discard, F
                      00358 
                      00359         ; LOCALIZAR AÇÃO NA TABELA
0057   08??           00360         MOVF    IrDA_DATA+1, W
MPASM 5.55  /HOME/GILSON/UFRGS/MICROS/PROJET   4-6-2014  5:50:36         PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0058   1800           00361         BTFSC   SMCON, MODEAUTO     ; testa qual tabela deve ser consultada auto/manual
0059   2???           00362         CALL    REMOTE_CONTROL_COMMANDS_AUTO
005A   1C00           00363         BTFSS   SMCON, MODEAUTO
005B   2???           00364         CALL    REMOTE_CONTROL_COMMANDS_MANUAL
                      00365 
005C   39FF           00366         ANDLW   0xFF
005D   1D03           00367         BTFSS   STATUS, Z
005E   2???           00368         CALL    COMMANDS
                      00369 
005F                  00370 IrDA_SAMPLER_ABORT
005F   2???           00371         CALL    INIT_IrDA       ; INICIALIZA ESTRUTURAS
0060   0008           00372         RETURN
                      00373 
                      00374 ;=============================================================================
                      00375 ;
                      00376 ;   GERENCIA SEQUENCIA PARA LEITURA E GRAVAÇÃO NA EEPROM
                      00377 ;
                      00378 ;=============================================================================
                      00379 
0061                  00380 RECORD_EEPROM:
0061   138B           00381         BCF     INTCON, GIE     ; DESATIVA INTERRUPÇÃO GLOBAL
0062   1B8B           00382         BTFSC   INTCON, GIE     ; TESTA SE INTERRUPÇÃO FOI DESABILITADA
0063   2???           00383         GOTO    $-2             ; REPETE SE AINDA NÃO ESTÁ DESATIVADO
0064   1683           00384         BSF     STATUS, RP0     ; APONTA PARA BLOCO 1
0065   119C           00385         BCF     EECON1, WRERR   ; REMOVE MARCAÇÃO DE ERRO DE GRAVAÇÃO
0066   151C           00386         BSF     EECON1, WREN    ; HABILITA GRAVAÇÃO
                      00387         ;MOVF    pos_value, W   ; COLOCA O DADO NO REGISTRADOR DE DADOS
0067   009A           00388         MOVWF   EEDAT
0068   08??           00389         MOVF    record_addr, W     ; COLOCA A POSIÇÃO NO REGISTRADOR DE POSIÇÃO
0069   009B           00390         MOVWF   EEADR
                      00391         ; SEQUENCIA DE INICIALIZAÇÃO EXIGIDA PARA A GRAVAÇÃO NA EEPROM
006A   3055           00392         MOVLW   0X55
006B   009D           00393         MOVWF   EECON2
006C   30AA           00394         MOVLW   0XAA
006D   009D           00395         MOVWF   EECON2
006E   149C           00396         BSF     EECON1, WR      ; ATIVA GRAVAÇÃO
                      00397         ; FIM DA SEQUENCIA EXIGIDA
006F   189C           00398         BTFSC   EECON1, WR      ; TESTA SE GRAVAÇÃO FOI CONCLUIDA
0070   2???           00399         GOTO $-1
0071   1283           00400         BCF     STATUS, RP0
0072   178B           00401         BSF     INTCON, GIE     ; HABILITA INTERRUPÇÃO GLOBAL
0073   0008           00402         RETURN
                      00403 
0074                  00404 READ_EEPROM:
0074   138B           00405         BCF     INTCON, GIE
0075   1683           00406         BSF     STATUS, RP0     ; APONTA PARA BLOCO 1
0076   3000           00407         MOVLW   ADDR_EE_POS
0077   009B           00408         MOVWF   EEADR
0078   141C           00409         BSF     EECON1, RD
0079   181C           00410         BTFSC   EECON1, RD
007A   2???           00411         GOTO    $-1
007B   081A           00412         MOVF    EEDAT, W
007C   00??           00413         MOVWF   pos_value
MPASM 5.55  /HOME/GILSON/UFRGS/MICROS/PROJET   4-6-2014  5:50:36         PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

007D   1283           00414         BCF     STATUS, RP0
007E   178B           00415         BSF     INTCON, GIE
007F   0008           00416         RETURN
                      00417 
                      00418 ;=============================================================================
                      00419 ;
                      00420 ; Rotina que implementa a conversão A/D do sensor de luminosidade e permanece
                      00421 ; até que se atinja o nível de luminosidade desejado
                      00422 ;
                      00423 ;=============================================================================
0080                  00424 AUTO_REFRESH:
0080   141F           00425         BSF     ADCON0, ADON        ; LIGA CONVERSOR A/D
0081   149F           00426         BSF     ADCON0, GO_NOT_DONE ; INICIA CONVERSÃO
                      00427 
0082                  00428 AD_DONE
0082   1C00           00429         BTFSS   SMCON, 0
0083   2???           00430         GOTO    REFRESH_END
0084   189F           00431         BTFSC   ADCON0, GO_NOT_DONE ; TESTA SE TERMINOU
0085   2???           00432         GOTO    AD_DONE
0086   081E           00433         MOVF    ADRESH, W           ; ARMAZENA O RESULTADO DA CONVERSÃO
                      00434 
0087   02??           00435         SUBWF   pos_value, W        ; COMPARA OS VALORES
0088   1903           00436         BTFSC   STATUS, Z           ; SE SÃO IGUAIS NÃO FAZ NADA
0089   2???           00437         GOTO    REFRESH_END
008A   149F           00438         BSF     ADCON0, GO_NOT_DONE ; INICIA NOVA CONVERSÃO
                      00439 
008B   1803           00440         BTFSC   STATUS, C
008C   2???           00441         goto    AD_FORWARD
008D   2???           00442         CALL    MOTOR_REVERSE       ; sentido anti-horário
008E                  00443 AD_END
008E   2???           00444         CALL    DELAYms
008F   2???           00445         CALL    DELAYms
0090   2???           00446         CALL    DELAYms
0091   2???           00447         CALL    DELAYms
0092   2???           00448         CALL    DELAYms
0093   2???           00449         GOTO    AD_DONE
                      00450 
                      00451 
0094                  00452 AD_FORWARD
0094   2???           00453         CALL    MOTOR_DIRECT        ; sentido horário
0095   2???           00454         GOTO    AD_END
                      00455 
0096                  00456 REFRESH_END
0096   101F           00457         BCF     ADCON0, ADON    ; DESLIGA CONVERSOR
0097   2???           00458         CALL    MOTOR_OFF       ; REMOVE CONSUMO DE CORRENTE
0098   0008           00459         RETURN
                      00460 
                      00461 ;=============================================================================
                      00462 ;
                      00463 ;   GERENCIA O MOTOR DE PASSO CONECTADO AS SAÍDAS RC2~RC5
                      00464 
0099                  00465 MOTOR_OFF:
0099   01??           00466         CLRF    w_temp
MPASM 5.55  /HOME/GILSON/UFRGS/MICROS/PROJET   4-6-2014  5:50:36         PAGE 10


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

009A   2???           00467         GOTO    MOTOR_DO
009B                  00468 MOTOR_DIRECT:
009B   0A??           00469         INCF    motor_pos, F
009C   2???           00470         GOTO    $+2
009D                  00471 MOTOR_REVERSE:
009D   03??           00472         DECF    motor_pos, F
009E   08??           00473         MOVF    motor_pos, W
009F   2???           00474         CALL    BIT_PATTERN
00A0   00??           00475         MOVWF   w_temp
                      00476 
00A1                  00477 MOTOR_DO
00A1   30C3           00478         MOVLW   b'11000011'
00A2   0507           00479         ANDWF   PORTC, W
00A3   04??           00480         IORWF   w_temp, W
00A4   0087           00481         MOVWF   PORTC
00A5   0008           00482         RETURN
                      00483 
                      00484 ;-----------------------------------------------------------------------------
                      00485 ;
                      00486 ;   Conversor binário -> BCD
                      00487 ;
                      00488 ;-----------------------------------------------------------------------------
                      00489 
00A6                  00490 BCD_CONVERT:
00A6   00??           00491     MOVWF VALUE_BIN
                      00492         ;inicializa laco (8 vezes)
00A7   3080           00493         MOVLW 0x80
00A8   00??           00494         MOVWF LOOP_BCD_COUNTER
00A9   01??           00495     CLRF B1                     ;b1; - primeiro byte com dois nibbles de bcd
00AA   01??           00496     CLRF B2                     ;b2; - segundo byte, com um unico nibble de bcd
                      00497 
00AB   2???           00498         GOTO KEEP_SHIFTING
00AC                  00499 LOOP_SHIFT
00AC   1980           00500         BTFSC B1, 3                 ;Testa se primeiro nibble eh maior ou igual a oito
00AD   2???           00501         GOTO ADD_B1_0
00AE   1D00           00502         BTFSS B1, 2                 ;Testa se eh maior ou igual a quatro
00AF   2???           00503         GOTO TEST_B1_1                          ;nibble ok, continuar
00B0   1880           00504         BTFSC B1, 1
00B1   2???           00505         GOTO ADD_B1_0                           ;tem que somar
00B2   1C00           00506         BTFSS B1, 0
00B3   2???           00507         GOTO TEST_B1_1
                      00508 
00B4                  00509 ADD_B1_0                                                ;primeiro nibble eh maior que 5
00B4   3003           00510         MOVLW 0x03
00B5   07??           00511         ADDWF B1, f                                     ;adiciona 3 ao nibble
                      00512 
00B6                  00513 TEST_B1_1
00B6   1B80           00514         BTFSC B1, 7                 ;Testa se primeiro nibble eh maior ou igual a oito
00B7   2???           00515         GOTO ADD_B1_1
00B8   1F00           00516         BTFSS B1, 6                 ;Testa se eh maior ou igual a quatro
00B9   2???           00517         GOTO TEST_B2                            ;nibble ok, continuar
00BA   1A80           00518         BTFSC B1, 5
00BB   2???           00519         GOTO ADD_B1_1                           ;tem que somar
MPASM 5.55  /HOME/GILSON/UFRGS/MICROS/PROJET   4-6-2014  5:50:36         PAGE 11


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00BC   1E00           00520         BTFSS B1, 4
00BD   2???           00521         GOTO TEST_B2
                      00522 
00BE                  00523 ADD_B1_1                                                ;segundo nibble eh maior que 5
00BE   3030           00524         MOVLW 0x30
00BF   07??           00525         ADDWF B1, f                                     ;adiciona 3 ao nibble
                      00526 
00C0                  00527 TEST_B2
00C0   1980           00528         BTFSC B2, 3                 ;Testa se primeiro nibble eh maior ou igual a oito
00C1   2???           00529         GOTO ADD_B2
00C2   1D00           00530         BTFSS B2, 2                 ;Testa se eh maior ou igual a quatro
00C3   2???           00531         GOTO KEEP_SHIFTING                      ;nibble ok, continuar
00C4   1880           00532         BTFSC B2, 1
00C5   2???           00533         GOTO ADD_B2                                     ;tem que somar
00C6   1C00           00534         BTFSS B2, 0
00C7   2???           00535         GOTO KEEP_SHIFTING
                      00536 
00C8                  00537 ADD_B2
00C8   3003           00538         MOVLW 0x03
00C9   07??           00539         ADDWF B2, f                 ;adiciona 3 ao nibble
                      00540 
00CA                  00541 KEEP_SHIFTING
Message[305]: Using default destination of 1 (file).
00CA   0D??           00542         RLF VALUE_BIN
Message[305]: Using default destination of 1 (file).
00CB   0D??           00543         RLF B1                      ;joga bit de carry no primeiro bit do registrador, shifta o registra
                            dor
Message[305]: Using default destination of 1 (file).
00CC   0D??           00544         RLF B2                      ;de novo, passa ultimo bit adiante
                      00545 
00CD   0C??           00546         RRF LOOP_BCD_COUNTER,f
00CE   08??           00547         MOVF LOOP_BCD_COUNTER,f         ;testa se valor do registrador eh zero
00CF   1D03           00548         BTFSS STATUS,Z              ;testa se chegamos ao fim da execucao
00D0   2???           00549         GOTO LOOP_SHIFT
00D1                  00550 final_da_execucao               ;realizar tratamentos finais
00D1   0008           00551         RETURN
                      00552 
                      00553 ;=============================================================================
                      00554 ;
                      00555 ; Envia os valores bcd em B1 e B2 para o display
                      00556 ;
                      00557 ; a sensibilidade do clock do receptor do display é a borda de subida
                      00558 ; para habilitar a saída manter enable em 0 para atualizar o display enviar pulso
                      00559 ; de clock na linha de enable.
                      00560 ;
                      00561 ; o shift é de 16 bits
                      00562 ;
                      00563 ;=============================================================================
00D2                  00564 SEND_DISPLAY:
00D2   1780           00565     BSF     SMCON, 7
                      00566 
00D3                  00567 START_SEND
00D3   08??           00568     MOVF    B1, W
MPASM 5.55  /HOME/GILSON/UFRGS/MICROS/PROJET   4-6-2014  5:50:36         PAGE 12


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00D4   2???           00569     CALL    SEVEN_SEG_CODE_LOOKUP
00D5   00??           00570     MOVWF   w_temp
00D6   3008           00571     MOVLW   0X08
00D7   00??           00572     MOVWF   count_disp
00D8                  00573 NEXT_BIT
00D8   0C??           00574     RRF     w_temp, F
                      00575 
                      00576     ; DEFINE BIT DE DADOS
00D9   1C03           00577     BTFSS   STATUS, C
00DA   1007           00578     BCF     PORTC, 0
00DB   1803           00579     BTFSC   STATUS, C
00DC   1407           00580     BSF     PORTC, 0
                      00581 
                      00582     ; APLICA TRANSIÇÃO
00DD   1087           00583     BCF     PORTC, 1
00DE   1487           00584     BSF     PORTC, 1
00DF   1087           00585     BCF     PORTC, 1
                      00586 
00E0   03??           00587     DECF    count_disp, F
00E1   1D03           00588     BTFSS   STATUS, Z
00E2   2???           00589     GOTO    NEXT_BIT
                      00590 
00E3   0E??           00591     SWAPF   B1, F
00E4   1F80           00592     BTFSS   SMCON, 7
00E5   2???           00593     GOTO    END_SEND
00E6   1380           00594     BCF     SMCON, 7
00E7   2???           00595     GOTO    START_SEND
                      00596 
                      00597 
00E8                  00598 END_SEND
                      00599     ; envia pulso de clock para o display atualizar
00E8   1285           00600     BCF     DISPLAYp, ENA_DISP
00E9   1685           00601     BSF     DISPLAYp, ENA_DISP
00EA   1285           00602     BCF     DISPLAYp, ENA_DISP
00EB   0008           00603     RETURN
                      00604 
                      00605 ;=============================================================================
                      00606 ;
                      00607 ;   padrão de ativação das bobinas do motor de passo para meio passo
                      00608 ;
                      00609 ;=============================================================================
                      00610     org     0x0200  ; AJUSTA INICIO DAS TABELAS, 255 POSIÇÕES
0200                  00611 BIT_PATTERN:
0200   018A           00612     CLRF    PCLATH
0201   148A           00613     BSF     PCLATH, 1   ; ACERTA DESLOCAMENTO SOMADO AO PCL
0202   3907           00614     ANDLW   0X07        ; remove possíveis saltos para fora da tabela
0203   0782           00615     ADDWF   PCL, F      ; move o PC para a posição desejada
0204   3404           00616     RETLW b'00000100'   ; A
0205   340C           00617     RETLW b'00001100'   ; A~B
0206   3408           00618     RETLW b'00001000'   ; ~B
0207   3418           00619     RETLW b'00011000'   ; ~A~B
0208   3410           00620     RETLW b'00010000'   ; ~A
0209   3430           00621     RETLW b'00110000'   ; ~AB
MPASM 5.55  /HOME/GILSON/UFRGS/MICROS/PROJET   4-6-2014  5:50:36         PAGE 13


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

020A   3420           00622     RETLW b'00100000'   ; B
020B   3424           00623     RETLW b'00100100'   ; AB
                      00624 
                      00625 ;============================================================================
                      00626 ;
                      00627 ;   CONTROLE REMOTO SONY RMT-V297C
                      00628 ;
                      00629 ;   CÓDIGO DE DISPOSITIVO
                      00630 ;   TV
                      00631 ;   SIRC12  00001
                      00632 ;
                      00633 ;   VCR
                      00634 ;   SIRC12  01011
                      00635 ;   SIRC15  10111010
                      00636 ;
                      00637 ;
                      00638 ;   KEYMAP:
                      00639 ;
                      00640 ;   1                           0x00    VCR/TV
                      00641 ;   2                           0x01    VCR/TV
                      00642 ;   3                           0x02    VCR/TV
                      00643 ;   4                           0x03    VCR/TV
                      00644 ;   5                           0x04    VCR/TV
                      00645 ;   6                           0x05    VCR/TV
                      00646 ;   7                           0x06    VCR/TV
                      00647 ;   8                           0x07    VCR/TV
                      00648 ;   9                           0x08    VCR/TV
                      00649 ;   0                           0x09    VCR/TV
                      00650 ;   ENTER                       0x0B    VCR/TV
                      00651 ;
                      00652 ;   CH+                         0x10    VCR/TV
                      00653 ;   CH-                         0x11    VCR/TV
                      00654 ;   VOL+                        0x12    TV
                      00655 ;   VOL-                        0x13    TV
                      00656 ;   X2                          0x14    VCR
                      00657 ;   POWER                       0x15    VCR/TV
                      00658 ;   EJECT                       0x16    VCR
                      00659 ;   AUDIO MONITOR       0x17    VCR/TV
                      00660 ;   REC                         0x1D    VCR
                      00661 ;   SLOW                        0x23    VCR
                      00662 ;   TV/VIDEO            0x25    TV
                      00663 ;   TV/VIDEO            0x2A    VCR
                      00664 ;   DISPLAY                     0x3A    TV
                      00665 ;   MENU                        0x4D    VCR
                      00666 ;   INPUT SELECT        0x4F    VCR
                      00667 ;   INDEX RIGHT         0x56    VCR
                      00668 ;   INDEX LEFT          0x57    VCR
                      00669 ;   SP/EP                       0x58    VCR
                      00670 ;   DISPLAY                     0x5A    VCR
                      00671 ;   EASY TIMER          0x60    VCR
                      00672 ;   CLEAR                       0x63    VCR
                      00673 ;
                      00674 ;   UP                          0x0E    VCR SIRC15
MPASM 5.55  /HOME/GILSON/UFRGS/MICROS/PROJET   4-6-2014  5:50:36         PAGE 14


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00675 ;   DOWN                        0x0F    VCR SIRC15
                      00676 ;   LEFT                        0x10    VCR SIRC15
                      00677 ;   RIGHT                       0x11    VCR SIRC15
                      00678 ;   PLAY/OK                     0x18    VCR SIRC15
                      00679 ;
                      00680 ;
                      00681 ;============================================================================
                      00682 
020C                  00683 REMOTE_CONTROL_COMMANDS_AUTO:
020C   018A           00684     CLRF    PCLATH
020D   148A           00685     BSF     PCLATH, 1   ; ACERTA O DESLOCAMENTO SOMADO AO PCL
020E   393F           00686     ANDLW   0X3F        ; remove possíveis saltos para fora da tabela
020F   0782           00687     ADDWF   PCL, F      ; move o PC para a posição desejada
0210   34??           00688     RETLW   cmd_digit   ;   1                           0x00    VCR/TV
0211   34??           00689     RETLW   cmd_digit   ;   2                           0x01    VCR/TV
0212   34??           00690     RETLW   cmd_digit   ;   3                           0x02    VCR/TV
0213   34??           00691     RETLW   cmd_digit   ;   4                           0x03    VCR/TV
0214   34??           00692     RETLW   cmd_digit   ;   5                           0x04    VCR/TV
0215   34??           00693     RETLW   cmd_digit   ;   6                           0x05    VCR/TV
0216   34??           00694     RETLW   cmd_digit   ;   7                           0x06    VCR/TV
0217   34??           00695     RETLW   cmd_digit   ;   8                           0x07    VCR/TV
0218   34??           00696     RETLW   cmd_digit   ;   9                           0x08    VCR/TV
0219   34??           00697     RETLW   cmd_digit   ;   0                           0x09    VCR/TV
021A   3400           00698     RETLW   0X00        ;                   0x0A
021B   34??           00699     RETLW   cmd_apply   ;   ENTER                       0x0B    VCR/TV
021C   3400           00700     RETLW   0X00        ;                   0x0C
021D   3400           00701     RETLW   0X00        ;                   0x0D
021E   3400           00702     RETLW   0X00        ;                   0x0E
021F   3400           00703     RETLW   0X00        ;                   0x0F
0220   3400           00704     RETLW   0X00        ;   CH+                         0x10    VCR/TV
0221   3400           00705     RETLW   0X00        ;   CH-                         0x11    VCR/TV
0222   34??           00706     RETLW   cmd_upper   ;   VOL+                        0x12    TV
0223   34??           00707     RETLW   cmd_lower   ;   VOL-                        0x13    TV
0224   3400           00708     RETLW   0X00        ;                   0x14
0225   34??           00709     RETLW   cmd_manual  ;   POWER                       0x15    VCR/TV
0226   3400           00710     RETLW   0X00        ;                   0x16
0227   3400           00711     RETLW   0X00        ;   AUDIO MONITOR       0x17    VCR/TV
0228   3400           00712     RETLW   0X00        ;                   0x18
0229   3400           00713     RETLW   0X00        ;                   0x19
022A   3400           00714     RETLW   0X00        ;                   0x1A
022B   3400           00715     RETLW   0X00        ;                   0x1B
022C   3400           00716     RETLW   0X00        ;                   0x1C
022D   3400           00717     RETLW   0X00        ;                   0x1D
022E   3400           00718     RETLW   0X00        ;                   0x1E
022F   3400           00719     RETLW   0X00        ;                   0x1F
0230   3400           00720     RETLW   0X00        ;                   0x20
0231   3400           00721     RETLW   0X00        ;                   0x21
0232   3400           00722     RETLW   0X00        ;                   0x22
0233   3400           00723     RETLW   0X00        ;                   0x23
0234   3400           00724     RETLW   0X00        ;                   0x24
0235   3400           00725     RETLW   0X00        ;   TV/VIDEO            0x25    TV
0236   3400           00726     RETLW   0X00        ;                   0x26
0237   3400           00727     RETLW   0X00        ;                   0x27
MPASM 5.55  /HOME/GILSON/UFRGS/MICROS/PROJET   4-6-2014  5:50:36         PAGE 15


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0238   3400           00728     RETLW   0X00        ;                   0x28
0239   3400           00729     RETLW   0X00        ;                   0x29
023A   3400           00730     RETLW   0X00        ;                   0x2A
023B   3400           00731     RETLW   0X00        ;                   0x2B
023C   3400           00732     RETLW   0X00        ;                   0x2C
023D   3400           00733     RETLW   0X00        ;                   0x2D
023E   3400           00734     RETLW   0X00        ;                   0x2E
023F   3400           00735     RETLW   0X00        ;                   0x2F
0240   3400           00736     RETLW   0X00        ;                   0x30
0241   3400           00737     RETLW   0X00        ;                   0x31
0242   3400           00738     RETLW   0X00        ;                   0x32
0243   3400           00739     RETLW   0X00        ;                   0x33
0244   3400           00740     RETLW   0X00        ;                   0x34
0245   3400           00741     RETLW   0X00        ;                   0x35
0246   3400           00742     RETLW   0X00        ;                   0x36
0247   3400           00743     RETLW   0X00        ;                   0x37
0248   3400           00744     RETLW   0X00        ;                   0x38
0249   3400           00745     RETLW   0X00        ;                   0x39
024A   34??           00746     RETLW   cmd_display ;   DISPLAY                     0x3A    TV
024B   3400           00747     RETLW   0X00        ;                   0x3B
024C   3400           00748     RETLW   0X00        ;                   0x3C
024D   3400           00749     RETLW   0X00        ;                   0x3D
024E   3400           00750     RETLW   0X00        ;                   0x3E
024F   3400           00751     RETLW   0X00        ;                   0x3F
                      00752 
0250                  00753 REMOTE_CONTROL_COMMANDS_MANUAL:
0250   018A           00754     CLRF    PCLATH
0251   148A           00755     BSF     PCLATH, 1       ; ACERTA O DESLOCAMENTO SOMADO AO PCL
0252   393F           00756     ANDLW   0X3F            ; remove possíveis saltos para fora da tabela
0253   0782           00757     ADDWF   PCL, F          ; move o PC para a posição desejada
0254   3400           00758     RETLW   0X00            ;   1                               0x00    VCR/TV
0255   3400           00759     RETLW   0X00            ;   2                               0x01    VCR/TV
0256   3400           00760     RETLW   0X00            ;   3                               0x02    VCR/TV
0257   3400           00761     RETLW   0X00            ;   4                               0x03    VCR/TV
0258   3400           00762     RETLW   0X00            ;   5                               0x04    VCR/TV
0259   3400           00763     RETLW   0X00            ;   6                               0x05    VCR/TV
025A   3400           00764     RETLW   0X00            ;   7                               0x06    VCR/TV
025B   3400           00765     RETLW   0X00            ;   8                               0x07    VCR/TV
025C   3400           00766     RETLW   0X00            ;   9                               0x08    VCR/TV
025D   3400           00767     RETLW   0X00            ;   0                               0x09    VCR/TV
025E   3400           00768     RETLW   0X00            ;                   0x0A
025F   3400           00769     RETLW   0X00            ;   ENTER                   0x0B    VCR/TV
0260   3400           00770     RETLW   0X00            ;                   0x0C
0261   3400           00771     RETLW   0X00            ;                   0x0D
0262   3400           00772     RETLW   0X00            ;                   0x0E
0263   3400           00773     RETLW   0X00            ;                   0x0F
0264   3400           00774     RETLW   0X00            ;   CH+                             0x10    VCR/TV
0265   3400           00775     RETLW   0X00            ;   CH-                             0x11    VCR/TV
0266   34??           00776     RETLW   cmd_open        ;   VOL+                    0x12    TV
0267   34??           00777     RETLW   cmd_close       ;   VOL-                    0x13    TV
0268   3400           00778     RETLW   0X00            ;                   0x14
0269   34??           00779     RETLW   cmd_auto        ;   POWER                   0x15    VCR/TV
026A   3400           00780     RETLW   0X00            ;                   0x16
MPASM 5.55  /HOME/GILSON/UFRGS/MICROS/PROJET   4-6-2014  5:50:36         PAGE 16


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

026B   3400           00781     RETLW   0X00            ;   AUDIO MONITOR   0x17    VCR/TV
026C   3400           00782     RETLW   0X00            ;                   0x18
026D   3400           00783     RETLW   0X00            ;                   0x19
026E   3400           00784     RETLW   0X00            ;                   0x1A
026F   3400           00785     RETLW   0X00            ;                   0x1B
0270   3400           00786     RETLW   0X00            ;                   0x1C
0271   3400           00787     RETLW   0X00            ;                   0x1D
0272   3400           00788     RETLW   0X00            ;                   0x1E
0273   3400           00789     RETLW   0X00            ;                   0x1F
0274   3400           00790     RETLW   0X00            ;                   0x20
0275   3400           00791     RETLW   0X00            ;                   0x21
0276   3400           00792     RETLW   0X00            ;                   0x22
0277   3400           00793     RETLW   0X00            ;                   0x23
0278   3400           00794     RETLW   0X00            ;                   0x24
0279   3400           00795     RETLW   0X00            ;   TV/VIDEO                0x25    TV
027A   3400           00796     RETLW   0X00            ;                   0x26
027B   3400           00797     RETLW   0X00            ;                   0x27
027C   3400           00798     RETLW   0X00            ;                   0x28
027D   3400           00799     RETLW   0X00            ;                   0x29
027E   3400           00800     RETLW   0X00            ;                   0x2A
027F   3400           00801     RETLW   0X00            ;                   0x2B
0280   3400           00802     RETLW   0X00            ;                   0x2C
0281   3400           00803     RETLW   0X00            ;                   0x2D
0282   3400           00804     RETLW   0X00            ;                   0x2E
0283   3400           00805     RETLW   0X00            ;                   0x2F
0284   3400           00806     RETLW   0X00            ;                   0x30
0285   3400           00807     RETLW   0X00            ;                   0x31
0286   3400           00808     RETLW   0X00            ;                   0x32
0287   3400           00809     RETLW   0X00            ;                   0x33
0288   3400           00810     RETLW   0X00            ;                   0x34
0289   3400           00811     RETLW   0X00            ;                   0x35
028A   3400           00812     RETLW   0X00            ;                   0x36
028B   3400           00813     RETLW   0X00            ;                   0x37
028C   3400           00814     RETLW   0X00            ;                   0x38
028D   3400           00815     RETLW   0X00            ;                   0x39
028E   34??           00816     RETLW   cmd_show_now    ;   DISPLAY                 0x3A    TV
028F   3400           00817     RETLW   0X00            ;                   0x3B
0290   3400           00818     RETLW   0X00            ;                   0x3C
0291   3400           00819     RETLW   0X00            ;                   0x3D
0292   3400           00820     RETLW   0X00            ;                   0x3E
0293   3400           00821     RETLW   0X00            ;                   0x3F
                      00822 
                      00823 
                      00824 
                      00825 ;TABELA PARA O DISPLAY DE SETE SEGMENTOS
                      00826 ;
                      00827 ; Lógica negada
                      00828 ;
                      00829 ;       a
                      00830 ;    f     b
                      00831 ;       g
                      00832 ;    e     c
                      00833 ;       d
MPASM 5.55  /HOME/GILSON/UFRGS/MICROS/PROJET   4-6-2014  5:50:36         PAGE 17


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00834 ;
                      00835 ;   byte = abcdefg(dot)
                      00836 
0294                  00837 SEVEN_SEG_CODE_LOOKUP:
0294   018A           00838     CLRF    PCLATH
0295   148A           00839     BSF PCLATH, 1
0296   390F           00840     ANDLW   0x0F
0297   0782           00841     ADDWF PCL, F
0298   3403           00842     RETLW b'00000011'           ;0
0299   349F           00843     RETLW b'10011111'           ;1
029A   3425           00844     RETLW b'00100101'           ;2
029B   340D           00845     RETLW b'00001101'           ;3
029C   3499           00846     RETLW b'10011001'           ;4
029D   3449           00847     RETLW b'01001001'           ;5
029E   3441           00848     RETLW b'01000001'           ;6
029F   341F           00849     RETLW b'00011111'           ;7
02A0   3401           00850     RETLW b'00000001'           ;8
02A1   3409           00851     RETLW b'00001001'           ;9
02A2   3405           00852     RETLW b'00000101'           ;a
02A3   34C1           00853     RETLW b'11000001'           ;b
02A4   34E5           00854     RETLW b'11100101'           ;c
02A5   3485           00855     RETLW b'10000101'           ;d
02A6   3421           00856     RETLW b'00100001'           ;e
02A7   3471           00857     RETLW b'01110001'           ;f
                      00858 
                      00859 ; tabela com valores a serem somados no conversor bcd -> binário
02A8                  00860 BCD_TO_BINARY_DOZENS:
02A8   00??           00861     MOVWF   w_temp
02A9   3C09           00862     SUBLW   0X09
02AA   1803           00863     BTFSC   STATUS, C
02AB   34FF           00864     RETLW   0XFF
02AC   148A           00865     BSF     PCLATH, 1
02AD   0782           00866     ADDWF   PCL, F
02AE   3400           00867     RETLW   0x00        ; 0
02AF   340A           00868     RETLW   0x0A        ; 10
02B0   3414           00869     RETLW   0x14        ; 20
02B1   341E           00870     RETLW   0x1E        ; 30
02B2   3428           00871     RETLW   0x28        ; 40
02B3   3432           00872     RETLW   0x32        ; 50
02B4   343C           00873     RETLW   0x3C        ; 60
02B5   3446           00874     RETLW   0x46        ; 70
02B6   3450           00875     RETLW   0x50        ; 80
02B7   345A           00876     RETLW   0x5A        ; 90
                      00877 
                      00878 
                      00879 
                      00880 ;------------------------------------------------------------------------------
                      00881 ;
                      00882 ; Funções que devem ser chamadas alterando o pcl, não devem ser chamadas com
                      00883 ; CALL, ver limite de endereço ao gerar o binário para se necessário ajustar o
                      00884 ; PCLATCH, por hora o pc latch deve ser 1
                      00885 ;
                      00886 ; Todas as funções devem terminar com:
MPASM 5.55  /HOME/GILSON/UFRGS/MICROS/PROJET   4-6-2014  5:50:36         PAGE 18


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00887 ;       goto    RETORNO_DE_COMANDO
                      00888 ;
                      00889 ;------------------------------------------------------------------------------
                      00890     org     0x0300
0300                  00891 COMMANDS:
0300   00??           00892         MOVWF   w_temp
0301   3003           00893         MOVLW   0X03
0302   008A           00894         MOVWF   PCLATH
0303   08??           00895         MOVF    w_temp, W
0304   0082           00896         MOVWF   PCL
                      00897 
0305                  00898 cmd_digit
0305                  00899 cmd_apply
0305                  00900 cmd_upper
0305                  00901 cmd_lower
0305   0008           00902         RETURN
                      00903 
0306                  00904 cmd_display
                      00905         ; converter valor especificado para bcd
0306   2???           00906         CALL    SEND_DISPLAY
0307   0008           00907         RETURN
                      00908 
                      00909 
                      00910 
                      00911 ; para o movimento ficar suave manter o tempo total desta execução em 4ms
0308                  00912 cmd_open
0308   01??           00913         clrf    counter
                      00914 
0309   2???           00915 st1     call    MOTOR_REVERSE
                      00916 
030A   2???           00917         call    DELAYms
                      00918         ;call    DELAYms
                      00919         ;call    DELAYms
                      00920         ;call    DELAYms
                      00921         ;call    DELAYms
030B   0A??           00922         incf    counter, F
030C   3028           00923         movlw   0x28
030D   06??           00924         xorwf   counter, w
030E   1D03           00925         btfss   STATUS, Z
                      00926 
030F   2???           00927         goto    st1
                      00928 
0310   2???           00929         call    MOTOR_OFF
0311   0008           00930         RETURN
                      00931 
                      00932 ; para o movimento ficar suave manter o tempo total desta execução em 4ms
0312                  00933 cmd_close
0312   01??           00934         clrf    counter
                      00935 
0313   2???           00936 st2     call    MOTOR_DIRECT
                      00937 
0314   2???           00938         call    DELAYms
                      00939         ;call    DELAYms
MPASM 5.55  /HOME/GILSON/UFRGS/MICROS/PROJET   4-6-2014  5:50:36         PAGE 19


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00940         ;call    DELAYms
                      00941         ;call    DELAYms
                      00942         ;call    DELAYms
0315   0A??           00943         incf    counter, F
0316   3028           00944         movlw   0x28
0317   06??           00945         xorwf   counter, w
0318   1D03           00946         btfss   STATUS, Z
                      00947 
0319   2???           00948         goto    st2
                      00949 
031A   2???           00950         call    MOTOR_OFF
031B   0008           00951         RETURN
                      00952 
031C                  00953 cmd_auto
031C   1400           00954         BSF     SMCON, MODEAUTO        ; coloca em modo automático
                      00955         ;CALL    AUTO_REFRESH
031D   0008           00956         RETURN
                      00957 
031E                  00958 cmd_manual
031E   1000           00959         BCF     SMCON, MODEAUTO
031F   0008           00960         RETURN
                      00961 
0320                  00962 cmd_show_now
                      00963         ;BSF     ADCON0, ADON        ; LIGA CONVERSOR A/D
                      00964         ;BSF     ADCON0, GO_NOT_DONE ; INICIA CONVERSÃO
                      00965         ;BTFSC   ADCON0, GO_NOT_DONE ; TESTA SE TERMINOU
                      00966         ;GOTO    $-1
                      00967         ;MOVF    ADRESH, W           ; ARMAZENA O RESULTADO DA CONVERSÃO
                      00968         ;MOVWF   B1
                      00969         ;CLRF    B2
0320   2???           00970         CALL    SEND_DISPLAY
0321   0008           00971         RETURN
                      00972 
                      00973 
3FF4                  00974     END                         ; directive 'end of program'
MPASM 5.55  /HOME/GILSON/UFRGS/MICROS/PROJET   4-6-2014  5:50:36         PAGE 20


SYMBOL TABLE
  LABEL                             VALUE 

ADCON0                            0000001F
ADCON1                            0000009F
ADCS0                             00000004
ADCS1                             00000005
ADCS2                             00000006
ADDR_EE_POS                       00000000
ADD_B1_0                          000000B4
ADD_B1_1                          000000BE
ADD_B2                            000000C8
ADFM                              00000007
ADIE                              00000006
ADIF                              00000006
ADON                              00000000
ADRESH                            0000001E
ADRESL                            0000009E
AD_DONE                           00000082
AD_END                            0000008E
AD_FORWARD                        00000094
ANS0                              00000000
ANS1                              00000001
ANS2                              00000002
ANS3                              00000003
ANS4                              00000004
ANS5                              00000005
ANS6                              00000006
ANS7                              00000007
ANSEL                             00000091
AUTO_REFRESH                      00000080
B1                                0000005B
B2                                0000005C
BCD_CONVERT                       000000A6
BCD_TO_BINARY_DOZENS              000002A8
BIT_PATTERN                       00000200
C                                 00000000
C1IE                              00000003
C1IF                              00000003
C1INV                             00000004
C1OUT                             00000006
C2IE                              00000004
C2IF                              00000004
C2INV                             00000005
C2OUT                             00000007
C2SYNC                            00000000
CCP1CON                           00000015
CCP1IE                            00000005
CCP1IF                            00000005
CCP1M0                            00000000
CCP1M1                            00000001
CCP1M2                            00000002
CCP1M3                            00000003
CCPR1                             00000013
CCPR1H                            00000014
CCPR1L                            00000013
MPASM 5.55  /HOME/GILSON/UFRGS/MICROS/PROJET   4-6-2014  5:50:36         PAGE 21


SYMBOL TABLE
  LABEL                             VALUE 

CHS0                              00000002
CHS1                              00000003
CHS2                              00000004
CIS                               00000003
CM0                               00000000
CM1                               00000001
CM2                               00000002
CMCON0                            00000019
CMCON1                            0000001A
COMMANDS                          00000300
DC                                00000001
DC1B0                             00000004
DC1B1                             00000005
DELAYms                           00000000
DEVICE                            00000001
DISPLAYp                          00000005
ECCPAS                            00000017
ECCPAS0                           00000004
ECCPAS1                           00000005
ECCPAS2                           00000006
ECCPASE                           00000007
ECCPIE                            00000005
ECCPIF                            00000005
EEADR                             0000009B
EECON1                            0000009C
EECON2                            0000009D
EEDAT                             0000009A
EEDATA                            0000009A
EEIE                              00000007
EEIF                              00000007
ENA_DISP                          00000005
END_INTERRUPT                     0000000D
END_SEND                          000000E8
F                                 00000001
FSR                               00000004
GIE                               00000007
GO                                00000001
GO_DONE                           00000001
GO_NOT_DONE                       00000001
HTS                               00000002
INDF                              00000000
INIT_IrDA                         0000000A
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTERRUPT                         00000004
INTF                              00000001
IOC                               00000096
IOC0                              00000000
IOC1                              00000001
IOC2                              00000002
IOC3                              00000003
IOC4                              00000004
MPASM 5.55  /HOME/GILSON/UFRGS/MICROS/PROJET   4-6-2014  5:50:36         PAGE 22


SYMBOL TABLE
  LABEL                             VALUE 

IOC5                              00000005
IOCA                              00000096
IOCA0                             00000000
IOCA1                             00000001
IOCA2                             00000002
IOCA3                             00000003
IOCA4                             00000004
IOCA5                             00000005
IRCF0                             00000004
IRCF1                             00000005
IRCF2                             00000006
IRP                               00000007
IrDA_COMMAND_12_BITS              00000042
IrDA_COMMAND_15_BITS              0000004B
IrDA_DATA                         00000052
IrDA_FALL                         0000000F
IrDA_FALLING                      00000013
IrDA_FALL_ABORT                   00000015
IrDA_FALL_SAMPLE                  00000018
IrDA_FALL_SAMPLE_1                00000017
IrDA_SAMPLER                      0000001C
IrDA_SAMPLER_1                    00000024
IrDA_SAMPLER_3                    0000002B
IrDA_SAMPLER_5                    0000002E
IrDA_SAMPLER_ABORT                0000005F
IrDA_TIME                         00000016
IrDA_bits                         00000050
IrDA_command                      00000055
IrDA_discard                      00000051
IrDAb                             00000002
IrDAp                             00000005
KEEP_SHIFTING                     000000CA
LOOP_BCD_COUNTER                  0000005D
LOOP_SHIFT                        000000AC
LTS                               00000001
MAIN_1                            00000024
MODEAUTO                          00000000
MOTOR_DIRECT                      0000009B
MOTOR_DO                          000000A1
MOTOR_OFF                         00000099
MOTOR_REVERSE                     0000009D
NEXT_BIT                          000000D8
NOT_BOD                           00000000
NOT_BOR                           00000000
NOT_DONE                          00000001
NOT_PD                            00000003
NOT_POR                           00000001
NOT_RAPU                          00000007
NOT_T1SYNC                        00000002
NOT_TO                            00000004
OPTION_REG                        00000081
OSCCON                            0000008F
OSCTUNE                           00000090
MPASM 5.55  /HOME/GILSON/UFRGS/MICROS/PROJET   4-6-2014  5:50:36         PAGE 23


SYMBOL TABLE
  LABEL                             VALUE 

OSFIE                             00000002
OSFIF                             00000002
OSTS                              00000003
P1M0                              00000006
P1M1                              00000007
PCL                               00000002
PCLATH                            0000000A
PCON                              0000008E
PDC0                              00000000
PDC1                              00000001
PDC2                              00000002
PDC3                              00000003
PDC4                              00000004
PDC5                              00000005
PDC6                              00000006
PEIE                              00000006
PIE1                              0000008C
PIR1                              0000000C
PORTA                             00000005
PORTC                             00000007
PR2                               00000092
PRSEN                             00000007
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
PSSAC0                            00000002
PSSAC1                            00000003
PSSBD0                            00000000
PSSBD1                            00000001
PWM1CON                           00000016
RA0                               00000000
RA1                               00000001
RA2                               00000002
RA3                               00000003
RA4                               00000004
RA5                               00000005
RAIE                              00000003
RAIF                              00000000
RC0                               00000000
RC1                               00000001
RC2                               00000002
RC3                               00000003
RC4                               00000004
RC5                               00000005
RD                                00000000
READ_EEPROM                       00000074
RECORD_EEPROM                     00000061
REFRESH_END                       00000096
REMOTE_CONTROL_COMMANDS_AUTO      0000020C
REMOTE_CONTROL_COMMANDS_MANUAL    00000250
RP0                               00000005
RP1                               00000006
MPASM 5.55  /HOME/GILSON/UFRGS/MICROS/PROJET   4-6-2014  5:50:36         PAGE 24


SYMBOL TABLE
  LABEL                             VALUE 

SBODEN                            00000004
SBOREN                            00000004
SCS                               00000000
SEND_DISPLAY                      000000D2
SEVEN_SEG_CODE_LOOKUP             00000294
SMCON                             00000056
START_SEND                        000000D3
STATUS                            00000003
SWDTEN                            00000000
T0CS                              00000005
T0IE                              00000005
T0IF                              00000002
T0SE                              00000004
T1CKPS0                           00000004
T1CKPS1                           00000005
T1CON                             00000010
T1GINV                            00000007
T1GSS                             00000001
T1IE                              00000000
T1IF                              00000000
T1OSCEN                           00000003
T2CKPS0                           00000000
T2CKPS1                           00000001
T2CON                             00000012
T2IE                              00000001
T2IF                              00000001
TEST_B1_1                         000000B6
TEST_B2                           000000C0
TMR0                              00000001
TMR0IE                            00000005
TMR0IF                            00000002
TMR1                              0000000E
TMR1CS                            00000001
TMR1GE                            00000006
TMR1H                             0000000F
TMR1IE                            00000000
TMR1IF                            00000000
TMR1L                             0000000E
TMR1ON                            00000000
TMR2                              00000011
TMR2IE                            00000001
TMR2IF                            00000001
TMR2ON                            00000002
TOUTPS0                           00000003
TOUTPS1                           00000004
TOUTPS2                           00000005
TOUTPS3                           00000006
TRISA                             00000085
TRISA0                            00000000
TRISA1                            00000001
TRISA2                            00000002
TRISA3                            00000003
TRISA4                            00000004
MPASM 5.55  /HOME/GILSON/UFRGS/MICROS/PROJET   4-6-2014  5:50:36         PAGE 25


SYMBOL TABLE
  LABEL                             VALUE 

TRISA5                            00000005
TRISC                             00000087
TRISC0                            00000000
TRISC1                            00000001
TRISC2                            00000002
TRISC3                            00000003
TRISC4                            00000004
TRISC5                            00000005
TUN0                              00000000
TUN1                              00000001
TUN2                              00000002
TUN3                              00000003
TUN4                              00000004
ULPWUE                            00000005
VALUE_BIN                         0000005E
VCFG                              00000006
VR0                               00000000
VR1                               00000001
VR2                               00000002
VR3                               00000003
VRCON                             00000099
VREN                              00000007
VRR                               00000005
W                                 00000000
WDTCON                            00000018
WDTPS0                            00000001
WDTPS1                            00000002
WDTPS2                            00000003
WDTPS3                            00000004
WPU                               00000095
WPU0                              00000000
WPU1                              00000001
WPU2                              00000002
WPU4                              00000004
WPU5                              00000005
WPUA                              00000095
WPUA0                             00000000
WPUA1                             00000001
WPUA2                             00000002
WPUA4                             00000004
WPUA5                             00000005
WR                                00000001
WREN                              00000002
WRERR                             00000003
Z                                 00000002
_BOD_NSLEEP                       00003EFF
_BOD_OFF                          00003CFF
_BOD_ON                           00003FFF
_BOD_SBODEN                       00003DFF
_BOREN_NSLEEP                     00003EFF
_BOREN_OFF                        00003CFF
_BOREN_ON                         00003FFF
_BOREN_SBODEN                     00003DFF
MPASM 5.55  /HOME/GILSON/UFRGS/MICROS/PROJET   4-6-2014  5:50:36         PAGE 26


SYMBOL TABLE
  LABEL                             VALUE 

_CONFIG                           00002007
_CPD_OFF                          00003FFF
_CPD_ON                           00003F7F
_CP_OFF                           00003FFF
_CP_ON                            00003FBF
_DEVID1                           00002006
_EC_OSC                           00003FFB
_EXTRC                            00003FFF
_EXTRCIO                          00003FFE
_EXTRC_OSC_CLKOUT                 00003FFF
_EXTRC_OSC_NOCLKOUT               00003FFE
_FCMEN_OFF                        000037FF
_FCMEN_ON                         00003FFF
_FOSC_EC                          00003FFB
_FOSC_EXTRCCLK                    00003FFF
_FOSC_EXTRCIO                     00003FFE
_FOSC_HS                          00003FFA
_FOSC_INTOSCCLK                   00003FFD
_FOSC_INTOSCIO                    00003FFC
_FOSC_LP                          00003FF8
_FOSC_XT                          00003FF9
_FUNCTIONS_0008                   00000008
_FUNCTIONS_0063                   00000063
_FUNCTIONS_0070                   00000070
_FUNCTIONS_007A                   0000007A
_FUNCTIONS_009C                   0000009C
_HS_OSC                           00003FFA
_IDLOC0                           00002000
_IDLOC1                           00002001
_IDLOC2                           00002002
_IDLOC3                           00002003
_IESO_OFF                         00003BFF
_IESO_ON                          00003FFF
_INTOSC                           00003FFD
_INTOSCIO                         00003FFC
_INTRC_OSC_CLKOUT                 00003FFD
_INTRC_OSC_NOCLKOUT               00003FFC
_LP_OSC                           00003FF8
_MCLRE_OFF                        00003FDF
_MCLRE_ON                         00003FFF
_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FEF
_WDTE_OFF                         00003FF7
_WDTE_ON                          00003FFF
_WDT_OFF                          00003FF7
_WDT_ON                           00003FFF
_XT_OSC                           00003FF9
__16F684                          00000001
__DEBUG                           
cmd_apply                         00000305
cmd_auto                          0000031C
cmd_close                         00000312
cmd_digit                         00000305
MPASM 5.55  /HOME/GILSON/UFRGS/MICROS/PROJET   4-6-2014  5:50:36         PAGE 27


SYMBOL TABLE
  LABEL                             VALUE 

cmd_display                       00000306
cmd_lower                         00000305
cmd_manual                        0000031E
cmd_open                          00000308
cmd_show_now                      00000320
cmd_upper                         00000305
count_disp                        00000057
counter                           0000005A
final_da_execucao                 000000D1
motor_pos                         00000059
pos_value                         00000058
record_addr                       00000004
record_data                       00000003
st1                               00000309
st2                               00000313
start                             00000000
status_bk                         00000002
w_bk                              00000001
w_temp                            00000000

Errors   :     0
Warnings :     0 reported,     0 suppressed
Messages :     3 reported,    23 suppressed

